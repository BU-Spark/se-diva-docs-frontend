{"ast":null,"code":"import { useCallback } from 'react';\nimport useAuthProvider, { defaultAuthParams } from './useAuthProvider';\nimport useLogout from './useLogout';\nimport { useNotify } from '../notification';\nimport { useBasename } from '../routing';\nimport { removeDoubleSlashes } from '../routing/useCreatePath';\n/**\n * Get a callback for calling the authProvider.checkAuth() method.\n * In case of rejection, redirects to the login page, displays a notification,\n * and throws an error.\n *\n * This is a low level hook. See those more specialized hooks\n * for common authentication tasks, based on useCheckAuth.\n *\n * @see useAuthenticated\n * @see useAuthState\n *\n * @returns {Function} checkAuth callback\n *\n * @example\n *\n * import { useCheckAuth } from 'react-admin';\n *\n * const MyProtectedPage = () => {\n *     const checkAuth = useCheckAuth();\n *     useEffect(() => {\n *         checkAuth().catch(() => {});\n *     }, []);\n *     return <p>Private content: EZAEZEZAET</p>\n * } // tip: use useAuthenticated() hook instead\n *\n * const MyPage = () => {\n *     const checkAuth = useCheckAuth();\n *     const [authenticated, setAuthenticated] = useState(true); // optimistic auth\n *     useEffect(() => {\n *         checkAuth({}, false)\n *              .then(() => setAuthenticated(true))\n *              .catch(() => setAuthenticated(false));\n *     }, []);\n *     return authenticated ? <Bar /> : <BarNotAuthenticated />;\n * } // tip: use useAuthState() hook instead\n */\nexport var useCheckAuth = function () {\n  var authProvider = useAuthProvider();\n  var notify = useNotify();\n  var logout = useLogout();\n  var basename = useBasename();\n  var loginUrl = removeDoubleSlashes(\"\".concat(basename, \"/\").concat(defaultAuthParams.loginUrl));\n  var checkAuth = useCallback(function (params, logoutOnFailure, redirectTo, disableNotification) {\n    if (params === void 0) {\n      params = {};\n    }\n    if (logoutOnFailure === void 0) {\n      logoutOnFailure = true;\n    }\n    if (redirectTo === void 0) {\n      redirectTo = loginUrl;\n    }\n    if (disableNotification === void 0) {\n      disableNotification = false;\n    }\n    return authProvider.checkAuth(params).catch(function (error) {\n      if (logoutOnFailure) {\n        logout({}, error && error.redirectTo != null ? error.redirectTo : redirectTo);\n        var shouldSkipNotify = disableNotification || error && error.message === false;\n        !shouldSkipNotify && notify(getErrorMessage(error, 'ra.auth.auth_check_error'), {\n          type: 'error'\n        });\n      }\n      throw error;\n    });\n  }, [authProvider, logout, notify, loginUrl]);\n  return authProvider ? checkAuth : checkAuthWithoutAuthProvider;\n};\nvar checkAuthWithoutAuthProvider = function () {\n  return Promise.resolve();\n};\nvar getErrorMessage = function (error, defaultMessage) {\n  return typeof error === 'string' ? error : typeof error === 'undefined' || !error.message ? defaultMessage : error.message;\n};","map":{"version":3,"mappings":"AAAA,SAASA,WAAW,QAAQ,OAAO;AAEnC,OAAOC,eAAe,IAAIC,iBAAiB,QAAQ,mBAAmB;AACtE,OAAOC,SAAS,MAAM,aAAa;AACnC,SAASC,SAAS,QAAQ,iBAAiB;AAC3C,SAASC,WAAW,QAAQ,YAAY;AACxC,SAASC,mBAAmB,QAAQ,0BAA0B;AAE9D;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoCA,OAAO,IAAMC,YAAY,GAAG;EACxB,IAAMC,YAAY,GAAGP,eAAe,EAAE;EACtC,IAAMQ,MAAM,GAAGL,SAAS,EAAE;EAC1B,IAAMM,MAAM,GAAGP,SAAS,EAAE;EAC1B,IAAMQ,QAAQ,GAAGN,WAAW,EAAE;EAC9B,IAAMO,QAAQ,GAAGN,mBAAmB,CAChC,UAAGK,QAAQ,cAAIT,iBAAiB,CAACU,QAAQ,CAAE,CAC9C;EAED,IAAMC,SAAS,GAAGb,WAAW,CACzB,UACIc,MAAgB,EAChBC,eAAsB,EACtBC,UAAqB,EACrBC,mBAA2B;IAH3B;MAAAH,WAAgB;IAAA;IAChB;MAAAC,sBAAsB;IAAA;IACtB;MAAAC,qBAAqB;IAAA;IACrB;MAAAC,2BAA2B;IAAA;IAE3B,mBAAY,CAACJ,SAAS,CAACC,MAAM,CAAC,CAACI,KAAK,CAAC,eAAK;MACtC,IAAIH,eAAe,EAAE;QACjBL,MAAM,CACF,EAAE,EACFS,KAAK,IAAIA,KAAK,CAACH,UAAU,IAAI,IAAI,GAC3BG,KAAK,CAACH,UAAU,GAChBA,UAAU,CACnB;QACD,IAAMI,gBAAgB,GAClBH,mBAAmB,IAClBE,KAAK,IAAIA,KAAK,CAACE,OAAO,KAAK,KAAM;QACtC,CAACD,gBAAgB,IACbX,MAAM,CACFa,eAAe,CAACH,KAAK,EAAE,0BAA0B,CAAC,EAClD;UAAEI,IAAI,EAAE;QAAO,CAAE,CACpB;;MAET,MAAMJ,KAAK;IACf,CAAC,CAAC;EAlBF,CAkBE,EACN,CAACX,YAAY,EAAEE,MAAM,EAAED,MAAM,EAAEG,QAAQ,CAAC,CAC3C;EAED,OAAOJ,YAAY,GAAGK,SAAS,GAAGW,4BAA4B;AAClE,CAAC;AAED,IAAMA,4BAA4B,GAAG;EAAM,cAAO,CAACC,OAAO,EAAE;AAAjB,CAAiB;AAqB5D,IAAMH,eAAe,GAAG,UAACH,KAAK,EAAEO,cAAc;EAC1C,cAAOP,KAAK,KAAK,QAAQ,GACnBA,KAAK,GACL,OAAOA,KAAK,KAAK,WAAW,IAAI,CAACA,KAAK,CAACE,OAAO,GAC9CK,cAAc,GACdP,KAAK,CAACE,OAAO;AAJnB,CAImB","names":["useCallback","useAuthProvider","defaultAuthParams","useLogout","useNotify","useBasename","removeDoubleSlashes","useCheckAuth","authProvider","notify","logout","basename","loginUrl","checkAuth","params","logoutOnFailure","redirectTo","disableNotification","catch","error","shouldSkipNotify","message","getErrorMessage","type","checkAuthWithoutAuthProvider","resolve","defaultMessage"],"sources":["/Users/paigedeveau/node_modules/ra-core/src/auth/useCheckAuth.ts"],"sourcesContent":["import { useCallback } from 'react';\n\nimport useAuthProvider, { defaultAuthParams } from './useAuthProvider';\nimport useLogout from './useLogout';\nimport { useNotify } from '../notification';\nimport { useBasename } from '../routing';\nimport { removeDoubleSlashes } from '../routing/useCreatePath';\n\n/**\n * Get a callback for calling the authProvider.checkAuth() method.\n * In case of rejection, redirects to the login page, displays a notification,\n * and throws an error.\n *\n * This is a low level hook. See those more specialized hooks\n * for common authentication tasks, based on useCheckAuth.\n *\n * @see useAuthenticated\n * @see useAuthState\n *\n * @returns {Function} checkAuth callback\n *\n * @example\n *\n * import { useCheckAuth } from 'react-admin';\n *\n * const MyProtectedPage = () => {\n *     const checkAuth = useCheckAuth();\n *     useEffect(() => {\n *         checkAuth().catch(() => {});\n *     }, []);\n *     return <p>Private content: EZAEZEZAET</p>\n * } // tip: use useAuthenticated() hook instead\n *\n * const MyPage = () => {\n *     const checkAuth = useCheckAuth();\n *     const [authenticated, setAuthenticated] = useState(true); // optimistic auth\n *     useEffect(() => {\n *         checkAuth({}, false)\n *              .then(() => setAuthenticated(true))\n *              .catch(() => setAuthenticated(false));\n *     }, []);\n *     return authenticated ? <Bar /> : <BarNotAuthenticated />;\n * } // tip: use useAuthState() hook instead\n */\nexport const useCheckAuth = (): CheckAuth => {\n    const authProvider = useAuthProvider();\n    const notify = useNotify();\n    const logout = useLogout();\n    const basename = useBasename();\n    const loginUrl = removeDoubleSlashes(\n        `${basename}/${defaultAuthParams.loginUrl}`\n    );\n\n    const checkAuth = useCallback(\n        (\n            params: any = {},\n            logoutOnFailure = true,\n            redirectTo = loginUrl,\n            disableNotification = false\n        ) =>\n            authProvider.checkAuth(params).catch(error => {\n                if (logoutOnFailure) {\n                    logout(\n                        {},\n                        error && error.redirectTo != null\n                            ? error.redirectTo\n                            : redirectTo\n                    );\n                    const shouldSkipNotify =\n                        disableNotification ||\n                        (error && error.message === false);\n                    !shouldSkipNotify &&\n                        notify(\n                            getErrorMessage(error, 'ra.auth.auth_check_error'),\n                            { type: 'error' }\n                        );\n                }\n                throw error;\n            }),\n        [authProvider, logout, notify, loginUrl]\n    );\n\n    return authProvider ? checkAuth : checkAuthWithoutAuthProvider;\n};\n\nconst checkAuthWithoutAuthProvider = () => Promise.resolve();\n\n/**\n * Check if the current user is authenticated by calling authProvider.checkAuth().\n * Logs the user out on failure.\n *\n * @param {Object} params The parameters to pass to the authProvider\n * @param {boolean} logoutOnFailure Whether the user should be logged out if the authProvider fails to authenticate them. True by default.\n * @param {string} redirectTo The login form url. Defaults to '/login'\n * @param {boolean} disableNotification Avoid showing a notification after the user is logged out. false by default.\n *\n * @return {Promise} Resolved to the authProvider response if the user passes the check, or rejected with an error otherwise\n */\nexport type CheckAuth = (\n    params?: any,\n    logoutOnFailure?: boolean,\n    redirectTo?: string,\n    /** @deprecated to disable the notification, authProvider.checkAuth() should return an object with an error property set to true */\n    disableNotification?: boolean\n) => Promise<any>;\n\nconst getErrorMessage = (error, defaultMessage) =>\n    typeof error === 'string'\n        ? error\n        : typeof error === 'undefined' || !error.message\n        ? defaultMessage\n        : error.message;\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}