{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nvar __spreadArray = this && this.__spreadArray || function (to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n    if (ar || !(i in from)) {\n      if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n      ar[i] = from[i];\n    }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n};\nimport { useCallback, useMemo, useEffect, useState, useRef } from 'react';\nimport { parse, stringify } from 'query-string';\nimport lodashDebounce from 'lodash/debounce';\nimport pickBy from 'lodash/pickBy';\nimport { useNavigate, useLocation } from 'react-router-dom';\nimport { useStore } from '../../store';\nimport queryReducer, { SET_FILTER, HIDE_FILTER, SHOW_FILTER, SET_PAGE, SET_PER_PAGE, SET_SORT, SORT_ASC } from './queryReducer';\nimport removeEmpty from '../../util/removeEmpty';\nimport { useIsMounted } from '../../util/hooks';\n/**\n * Get the list parameters (page, sort, filters) and modifiers.\n *\n * These parameters are merged from 3 sources:\n *   - the query string from the URL\n *   - the params stored in the state (from previous navigation)\n *   - the options passed to the hook (including the filter defaultValues)\n *\n * @returns {Array} A tuple [parameters, modifiers].\n * Destructure as [\n *    { page, perPage, sort, order, filter, filterValues, displayedFilters, requestSignature },\n *    { setFilters, hideFilter, showFilter, setPage, setPerPage, setSort }\n * ]\n *\n * @example\n *\n * const [listParams, listParamsActions] = useListParams({\n *      resource: 'posts',\n *      location: location // From react-router. Injected to your component by react-admin inside a List\n *      filterDefaultValues: {\n *          published: true\n *      },\n *      sort: {\n *          field: 'published_at',\n *          order: 'DESC'\n *      },\n *      perPage: 25\n * });\n *\n * const {\n *      page,\n *      perPage,\n *      sort,\n *      order,\n *      filter,\n *      filterValues,\n *      displayedFilters,\n *      requestSignature\n * } = listParams;\n *\n * const {\n *      setFilters,\n *      hideFilter,\n *      showFilter,\n *      setPage,\n *      setPerPage,\n *      setSort,\n * } = listParamsActions;\n */\nexport var useListParams = function (_a) {\n  var _b = _a.debounce,\n    debounce = _b === void 0 ? 500 : _b,\n    _c = _a.disableSyncWithLocation,\n    disableSyncWithLocation = _c === void 0 ? false : _c,\n    filterDefaultValues = _a.filterDefaultValues,\n    _d = _a.perPage,\n    perPage = _d === void 0 ? 10 : _d,\n    resource = _a.resource,\n    _e = _a.sort,\n    sort = _e === void 0 ? defaultSort : _e,\n    _f = _a.storeKey,\n    storeKey = _f === void 0 ? \"\".concat(resource, \".listParams\") : _f;\n  var location = useLocation();\n  var navigate = useNavigate();\n  var _g = useState(defaultParams),\n    localParams = _g[0],\n    setLocalParams = _g[1];\n  var _h = useStore(storeKey, defaultParams),\n    params = _h[0],\n    setParams = _h[1];\n  var tempParams = useRef();\n  var isMounted = useIsMounted();\n  var requestSignature = [location.search, resource, storeKey, JSON.stringify(disableSyncWithLocation ? localParams : params), JSON.stringify(filterDefaultValues), JSON.stringify(sort), perPage, disableSyncWithLocation];\n  var queryFromLocation = disableSyncWithLocation ? {} : parseQueryFromLocation(location);\n  var query = useMemo(function () {\n    return getQuery({\n      queryFromLocation: queryFromLocation,\n      params: disableSyncWithLocation ? localParams : params,\n      filterDefaultValues: filterDefaultValues,\n      sort: sort,\n      perPage: perPage\n    });\n  }, requestSignature // eslint-disable-line react-hooks/exhaustive-deps\n  );\n  // if the location includes params (for example from a link like\n  // the categories products on the demo), we need to persist them in the\n  // store as well so that we don't lose them after a redirection back\n  // to the list\n  useEffect(function () {\n    if (Object.keys(queryFromLocation).length > 0) {\n      setParams(query);\n    }\n  }, [location.search]); // eslint-disable-line\n  var changeParams = useCallback(function (action) {\n    // do not change params if the component is already unmounted\n    // this is necessary because changeParams can be debounced, and therefore\n    // executed after the component is unmounted\n    if (!isMounted.current) return;\n    if (!tempParams.current) {\n      // no other changeParams action dispatched this tick\n      tempParams.current = queryReducer(query, action);\n      // schedule side effects for next tick\n      setTimeout(function () {\n        if (disableSyncWithLocation) {\n          setLocalParams(tempParams.current);\n        } else {\n          // the useEffect above will apply the changes to the params in the store\n          navigate({\n            search: \"?\".concat(stringify(__assign(__assign({}, tempParams.current), {\n              filter: JSON.stringify(tempParams.current.filter),\n              displayedFilters: JSON.stringify(tempParams.current.displayedFilters)\n            })))\n          }, {\n            state: {\n              _scrollToTop: action.type === SET_PAGE\n            }\n          });\n        }\n        tempParams.current = undefined;\n      }, 0);\n    } else {\n      // side effects already scheduled, just change the params\n      tempParams.current = queryReducer(tempParams.current, action);\n    }\n  }, __spreadArray(__spreadArray([], requestSignature, true), [navigate], false));\n  var setSort = useCallback(function (sort) {\n    return changeParams({\n      type: SET_SORT,\n      payload: sort\n    });\n  }, [changeParams]);\n  var setPage = useCallback(function (newPage) {\n    return changeParams({\n      type: SET_PAGE,\n      payload: newPage\n    });\n  }, [changeParams]);\n  var setPerPage = useCallback(function (newPerPage) {\n    return changeParams({\n      type: SET_PER_PAGE,\n      payload: newPerPage\n    });\n  }, [changeParams]);\n  var filterValues = query.filter || emptyObject;\n  var displayedFilterValues = query.displayedFilters || emptyObject;\n  var debouncedSetFilters = lodashDebounce(function (filter, displayedFilters) {\n    changeParams({\n      type: SET_FILTER,\n      payload: {\n        filter: removeEmpty(filter),\n        displayedFilters: displayedFilters\n      }\n    });\n  }, debounce);\n  var setFilters = useCallback(function (filter, displayedFilters, debounce) {\n    if (debounce === void 0) {\n      debounce = true;\n    }\n    return debounce ? debouncedSetFilters(filter, displayedFilters) : changeParams({\n      type: SET_FILTER,\n      payload: {\n        filter: removeEmpty(filter),\n        displayedFilters: displayedFilters\n      }\n    });\n  }, [changeParams] // eslint-disable-line react-hooks/exhaustive-deps\n  );\n\n  var hideFilter = useCallback(function (filterName) {\n    changeParams({\n      type: HIDE_FILTER,\n      payload: filterName\n    });\n  }, [changeParams]);\n  var showFilter = useCallback(function (filterName, defaultValue) {\n    changeParams({\n      type: SHOW_FILTER,\n      payload: {\n        filterName: filterName,\n        defaultValue: defaultValue\n      }\n    });\n  }, [changeParams]);\n  return [__assign({\n    displayedFilters: displayedFilterValues,\n    filterValues: filterValues,\n    requestSignature: requestSignature\n  }, query), {\n    changeParams: changeParams,\n    setPage: setPage,\n    setPerPage: setPerPage,\n    setSort: setSort,\n    setFilters: setFilters,\n    hideFilter: hideFilter,\n    showFilter: showFilter\n  }];\n};\nexport var validQueryParams = ['page', 'perPage', 'sort', 'order', 'filter', 'displayedFilters'];\nvar parseObject = function (query, field) {\n  if (query[field] && typeof query[field] === 'string') {\n    try {\n      query[field] = JSON.parse(query[field]);\n    } catch (err) {\n      delete query[field];\n    }\n  }\n};\nexport var parseQueryFromLocation = function (_a) {\n  var search = _a.search;\n  var query = pickBy(parse(search), function (v, k) {\n    return validQueryParams.indexOf(k) !== -1;\n  });\n  parseObject(query, 'filter');\n  parseObject(query, 'displayedFilters');\n  return query;\n};\n/**\n * Check if user has already set custom sort, page, or filters for this list\n *\n * User params come from the store as the params props. By default,\n * this object is:\n *\n * { filter: {}, order: null, page: 1, perPage: null, sort: null }\n *\n * To check if the user has custom params, we must compare the params\n * to these initial values.\n *\n * @param {Object} params\n */\nexport var hasCustomParams = function (params) {\n  return params && params.filter && (Object.keys(params.filter).length > 0 || params.order != null || params.page !== 1 || params.perPage != null || params.sort != null);\n};\n/**\n * Merge list params from 3 different sources:\n *   - the query string\n *   - the params stored in the state (from previous navigation)\n *   - the props passed to the List component (including the filter defaultValues)\n */\nexport var getQuery = function (_a) {\n  var queryFromLocation = _a.queryFromLocation,\n    params = _a.params,\n    filterDefaultValues = _a.filterDefaultValues,\n    sort = _a.sort,\n    perPage = _a.perPage;\n  var query = Object.keys(queryFromLocation).length > 0 ? queryFromLocation : hasCustomParams(params) ? __assign({}, params) : {\n    filter: filterDefaultValues || {}\n  };\n  if (!query.sort) {\n    query.sort = sort.field;\n    query.order = sort.order;\n  }\n  if (query.perPage == null) {\n    query.perPage = perPage;\n  }\n  if (query.page == null) {\n    query.page = 1;\n  }\n  return __assign(__assign({}, query), {\n    page: getNumberOrDefault(query.page, 1),\n    perPage: getNumberOrDefault(query.perPage, 10)\n  });\n};\nexport var getNumberOrDefault = function (possibleNumber, defaultValue) {\n  var parsedNumber = typeof possibleNumber === 'string' ? parseInt(possibleNumber, 10) : possibleNumber;\n  return isNaN(parsedNumber) ? defaultValue : parsedNumber;\n};\nvar emptyObject = {};\nvar defaultSort = {\n  field: 'id',\n  order: SORT_ASC\n};\nvar defaultParams = {};","map":{"version":3,"mappings":"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","names":["useCallback","useMemo","useEffect","useState","useRef","parse","stringify","lodashDebounce","pickBy","useNavigate","useLocation","useStore","queryReducer","SET_FILTER","HIDE_FILTER","SHOW_FILTER","SET_PAGE","SET_PER_PAGE","SET_SORT","SORT_ASC","removeEmpty","useIsMounted","useListParams","_a","_b","debounce","_c","disableSyncWithLocation","filterDefaultValues","_d","perPage","resource","_e","sort","defaultSort","_f","storeKey","location","navigate","defaultParams","localParams","setLocalParams","params","setParams","tempParams","isMounted","requestSignature","search","JSON","queryFromLocation","parseQueryFromLocation","query","Object","keys","length","changeParams","current","action","setTimeout","filter","displayedFilters","state","_scrollToTop","type","undefined","setSort","payload","setPage","newPage","setPerPage","newPerPage","filterValues","emptyObject","displayedFilterValues","debouncedSetFilters","setFilters","hideFilter","filterName","showFilter","defaultValue","validQueryParams","parseObject","field","err","v","k","indexOf","hasCustomParams","order","page","getQuery","__assign","getNumberOrDefault","possibleNumber","parsedNumber","parseInt","isNaN"],"sources":["/Users/paigedeveau/Desktop/se-diva-docs-frontend/bwmdn-admin-portal/node_modules/ra-core/src/controller/list/useListParams.ts"],"sourcesContent":["import { useCallback, useMemo, useEffect, useState, useRef } from 'react';\nimport { parse, stringify } from 'query-string';\nimport lodashDebounce from 'lodash/debounce';\nimport pickBy from 'lodash/pickBy';\nimport { useNavigate, useLocation } from 'react-router-dom';\n\nimport { useStore } from '../../store';\nimport queryReducer, {\n    SET_FILTER,\n    HIDE_FILTER,\n    SHOW_FILTER,\n    SET_PAGE,\n    SET_PER_PAGE,\n    SET_SORT,\n    SORT_ASC,\n} from './queryReducer';\nimport { SortPayload, FilterPayload } from '../../types';\nimport removeEmpty from '../../util/removeEmpty';\nimport { useIsMounted } from '../../util/hooks';\n\nexport interface ListParams {\n    sort: string;\n    order: string;\n    page: number;\n    perPage: number;\n    filter: any;\n    displayedFilters: any;\n}\n\n/**\n * Get the list parameters (page, sort, filters) and modifiers.\n *\n * These parameters are merged from 3 sources:\n *   - the query string from the URL\n *   - the params stored in the state (from previous navigation)\n *   - the options passed to the hook (including the filter defaultValues)\n *\n * @returns {Array} A tuple [parameters, modifiers].\n * Destructure as [\n *    { page, perPage, sort, order, filter, filterValues, displayedFilters, requestSignature },\n *    { setFilters, hideFilter, showFilter, setPage, setPerPage, setSort }\n * ]\n *\n * @example\n *\n * const [listParams, listParamsActions] = useListParams({\n *      resource: 'posts',\n *      location: location // From react-router. Injected to your component by react-admin inside a List\n *      filterDefaultValues: {\n *          published: true\n *      },\n *      sort: {\n *          field: 'published_at',\n *          order: 'DESC'\n *      },\n *      perPage: 25\n * });\n *\n * const {\n *      page,\n *      perPage,\n *      sort,\n *      order,\n *      filter,\n *      filterValues,\n *      displayedFilters,\n *      requestSignature\n * } = listParams;\n *\n * const {\n *      setFilters,\n *      hideFilter,\n *      showFilter,\n *      setPage,\n *      setPerPage,\n *      setSort,\n * } = listParamsActions;\n */\nexport const useListParams = ({\n    debounce = 500,\n    disableSyncWithLocation = false,\n    filterDefaultValues,\n    perPage = 10,\n    resource,\n    sort = defaultSort,\n    storeKey = `${resource}.listParams`,\n}: ListParamsOptions): [Parameters, Modifiers] => {\n    const location = useLocation();\n    const navigate = useNavigate();\n    const [localParams, setLocalParams] = useState(defaultParams);\n    const [params, setParams] = useStore(storeKey, defaultParams);\n    const tempParams = useRef<ListParams>();\n    const isMounted = useIsMounted();\n\n    const requestSignature = [\n        location.search,\n        resource,\n        storeKey,\n        JSON.stringify(disableSyncWithLocation ? localParams : params),\n        JSON.stringify(filterDefaultValues),\n        JSON.stringify(sort),\n        perPage,\n        disableSyncWithLocation,\n    ];\n\n    const queryFromLocation = disableSyncWithLocation\n        ? {}\n        : parseQueryFromLocation(location);\n\n    const query = useMemo(\n        () =>\n            getQuery({\n                queryFromLocation,\n                params: disableSyncWithLocation ? localParams : params,\n                filterDefaultValues,\n                sort,\n                perPage,\n            }),\n        requestSignature // eslint-disable-line react-hooks/exhaustive-deps\n    );\n\n    // if the location includes params (for example from a link like\n    // the categories products on the demo), we need to persist them in the\n    // store as well so that we don't lose them after a redirection back\n    // to the list\n    useEffect(() => {\n        if (Object.keys(queryFromLocation).length > 0) {\n            setParams(query);\n        }\n    }, [location.search]); // eslint-disable-line\n\n    const changeParams = useCallback(\n        action => {\n            // do not change params if the component is already unmounted\n            // this is necessary because changeParams can be debounced, and therefore\n            // executed after the component is unmounted\n            if (!isMounted.current) return;\n\n            if (!tempParams.current) {\n                // no other changeParams action dispatched this tick\n                tempParams.current = queryReducer(query, action);\n                // schedule side effects for next tick\n                setTimeout(() => {\n                    if (disableSyncWithLocation) {\n                        setLocalParams(tempParams.current);\n                    } else {\n                        // the useEffect above will apply the changes to the params in the store\n                        navigate(\n                            {\n                                search: `?${stringify({\n                                    ...tempParams.current,\n                                    filter: JSON.stringify(\n                                        tempParams.current.filter\n                                    ),\n                                    displayedFilters: JSON.stringify(\n                                        tempParams.current.displayedFilters\n                                    ),\n                                })}`,\n                            },\n                            {\n                                state: {\n                                    _scrollToTop: action.type === SET_PAGE,\n                                },\n                            }\n                        );\n                    }\n                    tempParams.current = undefined;\n                }, 0);\n            } else {\n                // side effects already scheduled, just change the params\n                tempParams.current = queryReducer(tempParams.current, action);\n            }\n        },\n        [...requestSignature, navigate] // eslint-disable-line react-hooks/exhaustive-deps\n    );\n\n    const setSort = useCallback(\n        (sort: SortPayload) =>\n            changeParams({\n                type: SET_SORT,\n                payload: sort,\n            }),\n        [changeParams]\n    );\n\n    const setPage = useCallback(\n        (newPage: number) => changeParams({ type: SET_PAGE, payload: newPage }),\n        [changeParams]\n    );\n\n    const setPerPage = useCallback(\n        (newPerPage: number) =>\n            changeParams({ type: SET_PER_PAGE, payload: newPerPage }),\n        [changeParams]\n    );\n\n    const filterValues = query.filter || emptyObject;\n    const displayedFilterValues = query.displayedFilters || emptyObject;\n\n    const debouncedSetFilters = lodashDebounce((filter, displayedFilters) => {\n        changeParams({\n            type: SET_FILTER,\n            payload: {\n                filter: removeEmpty(filter),\n                displayedFilters,\n            },\n        });\n    }, debounce);\n\n    const setFilters = useCallback(\n        (filter, displayedFilters, debounce = true) =>\n            debounce\n                ? debouncedSetFilters(filter, displayedFilters)\n                : changeParams({\n                      type: SET_FILTER,\n                      payload: {\n                          filter: removeEmpty(filter),\n                          displayedFilters,\n                      },\n                  }),\n        [changeParams] // eslint-disable-line react-hooks/exhaustive-deps\n    );\n\n    const hideFilter = useCallback(\n        (filterName: string) => {\n            changeParams({\n                type: HIDE_FILTER,\n                payload: filterName,\n            });\n        },\n        [changeParams]\n    );\n\n    const showFilter = useCallback(\n        (filterName: string, defaultValue: any) => {\n            changeParams({\n                type: SHOW_FILTER,\n                payload: {\n                    filterName,\n                    defaultValue,\n                },\n            });\n        },\n        [changeParams]\n    );\n\n    return [\n        {\n            displayedFilters: displayedFilterValues,\n            filterValues,\n            requestSignature,\n            ...query,\n        },\n        {\n            changeParams,\n            setPage,\n            setPerPage,\n            setSort,\n            setFilters,\n            hideFilter,\n            showFilter,\n        },\n    ];\n};\n\nexport const validQueryParams = [\n    'page',\n    'perPage',\n    'sort',\n    'order',\n    'filter',\n    'displayedFilters',\n];\n\nconst parseObject = (query, field) => {\n    if (query[field] && typeof query[field] === 'string') {\n        try {\n            query[field] = JSON.parse(query[field]);\n        } catch (err) {\n            delete query[field];\n        }\n    }\n};\n\nexport const parseQueryFromLocation = ({ search }): Partial<ListParams> => {\n    const query = pickBy(\n        parse(search),\n        (v, k) => validQueryParams.indexOf(k) !== -1\n    );\n    parseObject(query, 'filter');\n    parseObject(query, 'displayedFilters');\n    return query;\n};\n\n/**\n * Check if user has already set custom sort, page, or filters for this list\n *\n * User params come from the store as the params props. By default,\n * this object is:\n *\n * { filter: {}, order: null, page: 1, perPage: null, sort: null }\n *\n * To check if the user has custom params, we must compare the params\n * to these initial values.\n *\n * @param {Object} params\n */\nexport const hasCustomParams = (params: ListParams) => {\n    return (\n        params &&\n        params.filter &&\n        (Object.keys(params.filter).length > 0 ||\n            params.order != null ||\n            params.page !== 1 ||\n            params.perPage != null ||\n            params.sort != null)\n    );\n};\n\n/**\n * Merge list params from 3 different sources:\n *   - the query string\n *   - the params stored in the state (from previous navigation)\n *   - the props passed to the List component (including the filter defaultValues)\n */\nexport const getQuery = ({\n    queryFromLocation,\n    params,\n    filterDefaultValues,\n    sort,\n    perPage,\n}) => {\n    const query: Partial<ListParams> =\n        Object.keys(queryFromLocation).length > 0\n            ? queryFromLocation\n            : hasCustomParams(params)\n            ? { ...params }\n            : { filter: filterDefaultValues || {} };\n\n    if (!query.sort) {\n        query.sort = sort.field;\n        query.order = sort.order;\n    }\n    if (query.perPage == null) {\n        query.perPage = perPage;\n    }\n    if (query.page == null) {\n        query.page = 1;\n    }\n\n    return {\n        ...query,\n        page: getNumberOrDefault(query.page, 1),\n        perPage: getNumberOrDefault(query.perPage, 10),\n    } as ListParams;\n};\n\nexport const getNumberOrDefault = (\n    possibleNumber: string | number | undefined,\n    defaultValue: number\n) => {\n    const parsedNumber =\n        typeof possibleNumber === 'string'\n            ? parseInt(possibleNumber, 10)\n            : possibleNumber;\n\n    return isNaN(parsedNumber) ? defaultValue : parsedNumber;\n};\n\nexport interface ListParamsOptions {\n    debounce?: number;\n    // Whether to disable the synchronization of the list parameters with\n    // the current location (URL search parameters)\n    disableSyncWithLocation?: boolean;\n    // default value for a filter when displayed but not yet set\n    filterDefaultValues?: FilterPayload;\n    perPage?: number;\n    resource: string;\n    sort?: SortPayload;\n    storeKey?: string;\n}\n\ninterface Parameters extends ListParams {\n    filterValues: object;\n    displayedFilters: {\n        [key: string]: boolean;\n    };\n    requestSignature: any[];\n}\n\ninterface Modifiers {\n    changeParams: (action: any) => void;\n    setPage: (page: number) => void;\n    setPerPage: (pageSize: number) => void;\n    setSort: (sort: SortPayload) => void;\n    setFilters: (filters: any, displayedFilters: any) => void;\n    hideFilter: (filterName: string) => void;\n    showFilter: (filterName: string, defaultValue: any) => void;\n}\n\nconst emptyObject = {};\n\nconst defaultSort = {\n    field: 'id',\n    order: SORT_ASC,\n};\n\nconst defaultParams = {};\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}