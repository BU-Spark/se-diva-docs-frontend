{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\nimport { isValidElement, useEffect, useMemo } from 'react';\nimport { useAuthenticated } from '../../auth';\nimport { useTranslate } from '../../i18n';\nimport { useNotify } from '../../notification';\nimport { useGetList } from '../../dataProvider';\nimport { SORT_ASC } from './queryReducer';\nimport { defaultExporter } from '../../export';\nimport { useResourceContext, useGetResourceLabel } from '../../core';\nimport { useRecordSelection } from './useRecordSelection';\nimport { useListParams } from './useListParams';\n/**\n * Prepare data for the List view\n *\n * @param {Object} props The props passed to the List component.\n *\n * @return {Object} controllerProps Fetched and computed data for the List view\n *\n * @example\n *\n * import { useListController } from 'react-admin';\n * import ListView from './ListView';\n *\n * const MyList = props => {\n *     const controllerProps = useListController(props);\n *     return <ListView {...controllerProps} {...props} />;\n * }\n */\nexport var useListController = function (props) {\n  if (props === void 0) {\n    props = {};\n  }\n  var _a = props.debounce,\n    debounce = _a === void 0 ? 500 : _a,\n    disableAuthentication = props.disableAuthentication,\n    disableSyncWithLocation = props.disableSyncWithLocation,\n    _b = props.exporter,\n    exporter = _b === void 0 ? defaultExporter : _b,\n    filter = props.filter,\n    filterDefaultValues = props.filterDefaultValues,\n    _c = props.perPage,\n    perPage = _c === void 0 ? 10 : _c,\n    _d = props.queryOptions,\n    queryOptions = _d === void 0 ? {} : _d,\n    _e = props.sort,\n    sort = _e === void 0 ? defaultSort : _e,\n    storeKey = props.storeKey;\n  useAuthenticated({\n    enabled: !disableAuthentication\n  });\n  var resource = useResourceContext(props);\n  var meta = queryOptions.meta,\n    otherQueryOptions = __rest(queryOptions, [\"meta\"]);\n  if (!resource) {\n    throw new Error(\"<List> was called outside of a ResourceContext and without a resource prop. You must set the resource prop.\");\n  }\n  if (filter && isValidElement(filter)) {\n    throw new Error('<List> received a React element as `filter` props. If you intended to set the list filter elements, use the `filters` (with an s) prop instead. The `filter` prop is internal and should not be set by the developer.');\n  }\n  var translate = useTranslate();\n  var notify = useNotify();\n  var _f = useListParams({\n      debounce: debounce,\n      disableSyncWithLocation: disableSyncWithLocation,\n      filterDefaultValues: filterDefaultValues,\n      perPage: perPage,\n      resource: resource,\n      sort: sort,\n      storeKey: storeKey\n    }),\n    query = _f[0],\n    queryModifiers = _f[1];\n  var _g = useRecordSelection(resource),\n    selectedIds = _g[0],\n    selectionModifiers = _g[1];\n  var _h = useGetList(resource, {\n      pagination: {\n        page: query.page,\n        perPage: query.perPage\n      },\n      sort: {\n        field: query.sort,\n        order: query.order\n      },\n      filter: __assign(__assign({}, query.filter), filter),\n      meta: meta\n    }, __assign({\n      keepPreviousData: true,\n      retry: false,\n      onError: function (error) {\n        return notify((error === null || error === void 0 ? void 0 : error.message) || 'ra.notification.http_error', {\n          type: 'warning',\n          messageArgs: {\n            _: error === null || error === void 0 ? void 0 : error.message\n          }\n        });\n      }\n    }, otherQueryOptions)),\n    data = _h.data,\n    pageInfo = _h.pageInfo,\n    total = _h.total,\n    error = _h.error,\n    isLoading = _h.isLoading,\n    isFetching = _h.isFetching,\n    refetch = _h.refetch;\n  // change page if there is no data\n  useEffect(function () {\n    if (query.page <= 0 || !isFetching && query.page > 1 && (data == null || (data === null || data === void 0 ? void 0 : data.length) === 0)) {\n      // Query for a page that doesn't exist, set page to 1\n      queryModifiers.setPage(1);\n      return;\n    }\n    if (total == null) {\n      return;\n    }\n    var totalPages = Math.ceil(total / query.perPage) || 1;\n    if (!isFetching && query.page > totalPages) {\n      // Query for a page out of bounds, set page to the last existing page\n      // It occurs when deleting the last element of the last page\n      queryModifiers.setPage(totalPages);\n    }\n  }, [isFetching, query.page, query.perPage, data, queryModifiers, total]);\n  var currentSort = useMemo(function () {\n    return {\n      field: query.sort,\n      order: query.order\n    };\n  }, [query.sort, query.order]);\n  var getResourceLabel = useGetResourceLabel();\n  var defaultTitle = translate('ra.page.list', {\n    name: getResourceLabel(resource, 2)\n  });\n  return {\n    sort: currentSort,\n    data: data,\n    defaultTitle: defaultTitle,\n    displayedFilters: query.displayedFilters,\n    error: error,\n    exporter: exporter,\n    filter: filter,\n    filterValues: query.filterValues,\n    hideFilter: queryModifiers.hideFilter,\n    isFetching: isFetching,\n    isLoading: isLoading,\n    onSelect: selectionModifiers.select,\n    onToggleItem: selectionModifiers.toggle,\n    onUnselectItems: selectionModifiers.clearSelection,\n    page: query.page,\n    perPage: query.perPage,\n    refetch: refetch,\n    resource: resource,\n    selectedIds: selectedIds,\n    setFilters: queryModifiers.setFilters,\n    setPage: queryModifiers.setPage,\n    setPerPage: queryModifiers.setPerPage,\n    setSort: queryModifiers.setSort,\n    showFilter: queryModifiers.showFilter,\n    total: total,\n    hasNextPage: pageInfo ? pageInfo.hasNextPage : total != null ? query.page * query.perPage < total : undefined,\n    hasPreviousPage: pageInfo ? pageInfo.hasPreviousPage : query.page > 1\n  };\n};\nvar defaultSort = {\n  field: 'id',\n  order: SORT_ASC\n};\nexport var injectedProps = ['sort', 'data', 'defaultTitle', 'displayedFilters', 'error', 'exporter', 'filterValues', 'hideFilter', 'isFetching', 'isLoading', 'onSelect', 'onToggleItem', 'onUnselectItems', 'page', 'perPage', 'refetch', 'refresh', 'resource', 'selectedIds', 'setFilters', 'setPage', 'setPerPage', 'setSort', 'showFilter', 'total', 'totalPages'];\n/**\n * Select the props injected by the useListController hook\n * to be passed to the List children need\n * This is an implementation of pick()\n */\nexport var getListControllerProps = function (props) {\n  return injectedProps.reduce(function (acc, key) {\n    var _a;\n    return __assign(__assign({}, acc), (_a = {}, _a[key] = props[key], _a));\n  }, {});\n};\n/**\n * Select the props not injected by the useListController hook\n * to be used inside the List children to sanitize props injected by List\n * This is an implementation of omit()\n */\nexport var sanitizeListRestProps = function (props) {\n  return Object.keys(props).filter(function (propName) {\n    return !injectedProps.includes(propName);\n  }).reduce(function (acc, key) {\n    var _a;\n    return __assign(__assign({}, acc), (_a = {}, _a[key] = props[key], _a));\n  }, {});\n};","map":{"version":3,"mappings":"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","names":["isValidElement","useEffect","useMemo","useAuthenticated","useTranslate","useNotify","useGetList","SORT_ASC","defaultExporter","useResourceContext","useGetResourceLabel","useRecordSelection","useListParams","useListController","props","debounce","disableAuthentication","disableSyncWithLocation","_b","exporter","filter","filterDefaultValues","_c","perPage","_d","queryOptions","_e","sort","defaultSort","storeKey","enabled","resource","otherQueryOptions","Error","translate","notify","query","queryModifiers","selectedIds","selectionModifiers","pagination","page","field","order","meta","keepPreviousData","retry","onError","error","message","type","messageArgs","_","data","pageInfo","total","isLoading","isFetching","refetch","length","setPage","totalPages","Math","ceil","currentSort","getResourceLabel","defaultTitle","name","displayedFilters","filterValues","hideFilter","onSelect","select","onToggleItem","toggle","onUnselectItems","clearSelection","setFilters","setPerPage","setSort","showFilter","hasNextPage","undefined","hasPreviousPage","injectedProps","getListControllerProps","reduce","acc","key","sanitizeListRestProps","keys","includes","propName"],"sourceRoot":"","sources":["../../../../src/controller/list/useListController.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}