{"ast":null,"code":"var RA_STORE = 'RaStore';\n// localStorage isn't available in incognito mode. We need to detect it\nvar testLocalStorage = function () {\n  // eslint-disable-next-line eqeqeq\n  if (typeof window === 'undefined' || window.localStorage == undefined) {\n    return false;\n  }\n  try {\n    window.localStorage.setItem('test', 'test');\n    window.localStorage.removeItem('test');\n    return true;\n  } catch (e) {\n    return false;\n  }\n};\nvar localStorageAvailable = testLocalStorage();\n/**\n * Store using localStorage, or memory storage in incognito mode\n *\n * @example\n *\n * import { localStorageStore } from 'react-admin';\n *\n * const App = () => (\n *    <Admin store={localStorageStore()}>\n *       ...\n *   </Admin>\n * );\n */\nexport var localStorageStore = function (version, appKey) {\n  if (version === void 0) {\n    version = '1';\n  }\n  if (appKey === void 0) {\n    appKey = '';\n  }\n  var prefix = \"\".concat(RA_STORE).concat(appKey);\n  var prefixLength = prefix.length;\n  var subscriptions = {};\n  var publish = function (key, value) {\n    Object.keys(subscriptions).forEach(function (id) {\n      if (!subscriptions[id]) return; // may happen if a component unmounts after a first subscriber was notified\n      if (subscriptions[id].key === key) {\n        subscriptions[id].callback(value);\n      }\n    });\n  };\n  // Whenever the local storage changes in another document, look for matching subscribers.\n  // This allows to synchronize state across tabs\n  var onLocalStorageChange = function (event) {\n    var _a;\n    if (((_a = event.key) === null || _a === void 0 ? void 0 : _a.substring(0, prefixLength)) !== prefix) {\n      return;\n    }\n    var key = event.key.substring(prefixLength + 1);\n    var value = event.newValue ? tryParse(event.newValue) : undefined;\n    Object.keys(subscriptions).forEach(function (id) {\n      if (!subscriptions[id]) return; // may happen if a component unmounts after a first subscriber was notified\n      if (subscriptions[id].key === key) {\n        if (value === null) {\n          // an event with a null value is sent when the key is deleted.\n          // to enable default value, we need to call setValue(undefined) instead of setValue(null)\n          subscriptions[id].callback(undefined);\n        } else {\n          subscriptions[id].callback(value == null ? undefined : value);\n        }\n      }\n    });\n  };\n  return {\n    setup: function () {\n      if (localStorageAvailable) {\n        var storedVersion = getStorage().getItem(\"\".concat(prefix, \".version\"));\n        if (storedVersion && storedVersion !== version) {\n          var storage_1 = getStorage();\n          Object.keys(storage_1).forEach(function (key) {\n            if (key.startsWith(prefix)) {\n              storage_1.removeItem(key);\n            }\n          });\n        }\n        getStorage().setItem(\"\".concat(prefix, \".version\"), version);\n        window.addEventListener('storage', onLocalStorageChange);\n      }\n    },\n    teardown: function () {\n      if (localStorageAvailable) {\n        window.removeEventListener('storage', onLocalStorageChange);\n      }\n    },\n    getItem: function (key, defaultValue) {\n      var valueFromStorage = getStorage().getItem(\"\".concat(prefix, \".\").concat(key));\n      // eslint-disable-next-line eqeqeq\n      return valueFromStorage == null ? defaultValue : tryParse(valueFromStorage);\n    },\n    setItem: function (key, value) {\n      if (value === undefined) {\n        getStorage().removeItem(\"\".concat(prefix, \".\").concat(key));\n      } else {\n        getStorage().setItem(\"\".concat(prefix, \".\").concat(key), JSON.stringify(value));\n      }\n      publish(key, value);\n    },\n    removeItem: function (key) {\n      getStorage().removeItem(\"\".concat(prefix, \".\").concat(key));\n      publish(key, undefined);\n    },\n    removeItems: function (keyPrefix) {\n      var storage = getStorage();\n      Object.keys(storage).forEach(function (key) {\n        if (key.startsWith(\"\".concat(prefix, \".\").concat(keyPrefix))) {\n          storage.removeItem(key);\n          var publishKey = key.substring(prefixLength + 1);\n          publish(publishKey, undefined);\n        }\n      });\n    },\n    reset: function () {\n      var storage = getStorage();\n      Object.keys(storage).forEach(function (key) {\n        if (key.startsWith(prefix)) {\n          storage.removeItem(key);\n          var publishKey = key.substring(prefixLength + 1);\n          publish(publishKey, undefined);\n        }\n      });\n    },\n    subscribe: function (key, callback) {\n      var id = Math.random().toString();\n      subscriptions[id] = {\n        key: key,\n        callback: callback\n      };\n      return function () {\n        delete subscriptions[id];\n      };\n    }\n  };\n};\nvar tryParse = function (value) {\n  try {\n    return JSON.parse(value);\n  } catch (e) {\n    return value;\n  }\n};\nvar LocalStorageShim = /** @class */function () {\n  function LocalStorageShim() {\n    this.valuesMap = new Map();\n  }\n  LocalStorageShim.prototype.getItem = function (key) {\n    if (this.valuesMap.has(key)) {\n      return String(this.valuesMap.get(key));\n    }\n    return null;\n  };\n  LocalStorageShim.prototype.setItem = function (key, value) {\n    this.valuesMap.set(key, value);\n  };\n  LocalStorageShim.prototype.removeItem = function (key) {\n    this.valuesMap.delete(key);\n  };\n  LocalStorageShim.prototype.removeItems = function (keyPrefix) {\n    var _this = this;\n    this.valuesMap.forEach(function (value, key) {\n      if (key.startsWith(keyPrefix)) {\n        _this.valuesMap.delete(key);\n      }\n    });\n  };\n  LocalStorageShim.prototype.clear = function () {\n    this.valuesMap.clear();\n  };\n  LocalStorageShim.prototype.key = function (i) {\n    if (arguments.length === 0) {\n      throw new TypeError(\"Failed to execute 'key' on 'Storage': 1 argument required, but only 0 present.\"); // this is a TypeError implemented on Chrome, Firefox throws Not enough arguments to Storage.key.\n    }\n\n    var arr = Array.from(this.valuesMap.keys());\n    return arr[i];\n  };\n  Object.defineProperty(LocalStorageShim.prototype, \"length\", {\n    get: function () {\n      return this.valuesMap.size;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  return LocalStorageShim;\n}();\nvar memoryStorage = new LocalStorageShim();\nexport var getStorage = function () {\n  return localStorageAvailable ? window.localStorage : memoryStorage;\n};","map":{"version":3,"mappings":"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","names":["RA_STORE","testLocalStorage","window","localStorage","undefined","setItem","removeItem","e","localStorageAvailable","localStorageStore","version","appKey","prefix","prefixLength","length","subscriptions","publish","key","value","Object","keys","forEach","id","callback","onLocalStorageChange","event","substring","newValue","tryParse","setup","storedVersion","getStorage","getItem","storage_1","startsWith","addEventListener","teardown","removeEventListener","defaultValue","valueFromStorage","JSON","stringify","removeItems","keyPrefix","storage","publishKey","reset","subscribe","Math","random","toString","parse","Map","LocalStorageShim","valuesMap","has","String","get","set","delete","_this","clear","i","arguments","TypeError","arr","Array","from","size","memoryStorage"],"sourceRoot":"","sources":["../../../src/store/localStorageStore.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}